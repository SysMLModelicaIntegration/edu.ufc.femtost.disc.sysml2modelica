<?xml version="1.0" encoding="ISO-8859-1"?>
<Modelica:ModelicaModel xmi:version="2.0" xmlns:xmi="http://www.omg.org/XMI" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:Modelica="http://www.femto-st.fr/disc/Modelica.ecore" name="Two_tanks">
  <modelicaClasses xsi:type="Modelica:Package" name="Design" withinClause="Two_tanks">
    <modelicaClasses xsi:type="Modelica:Package" name="Interface" withinClause="Two_tanks/Design">
      <modelicaClasses xsi:type="Modelica:Connector" name="ActSignal">
        <modelicaComponents xsi:type="Modelica:ModelicaValueProperty" name="act" modification="" type_specifier="Real"/>
      </modelicaClasses>
      <modelicaClasses xsi:type="Modelica:Connector" name="ReadSignal">
        <modelicaComponents xsi:type="Modelica:ModelicaValueProperty" name="val" modification="" type_specifier="Real"/>
      </modelicaClasses>
      <modelicaClasses xsi:type="Modelica:Connector" name="LiquidFlow">
        <modelicaComponents xsi:type="Modelica:ModelicaValueProperty" name="lflow" modification="" type_specifier="Real"/>
      </modelicaClasses>
    </modelicaClasses>
    <modelicaClasses xsi:type="Modelica:Package" name="Components" withinClause="Two_tanks/Design">
      <modelicaClasses xsi:type="Modelica:Model" name="BaseController" isPartial="true">
        <modelicaComponents xsi:type="Modelica:ModelicaValueProperty" name="K" modification="" type_specifier="Real" variability="parameter" default_value="2.0"/>
        <modelicaComponents xsi:type="Modelica:ModelicaValueProperty" name="T" modification="unit = &quot;s&quot;" type_specifier="Real" variability="parameter" default_value="10.0"/>
        <modelicaComponents xsi:type="Modelica:ModelicaValueProperty" name="ref" modification="" type_specifier="Real" variability="parameter"/>
        <modelicaComponents xsi:type="Modelica:ModelicaValueProperty" name="error" modification="" type_specifier="Real"/>
        <modelicaComponents xsi:type="Modelica:ModelicaValueProperty" name="outCtr" modification="" type_specifier="Real"/>
        <equationSection>
          <equations body="error = ref - cIn.val"/>
          <equations body="cOut.act = outCtr"/>
        </equationSection>
      </modelicaClasses>
      <modelicaClasses xsi:type="Modelica:Model" name="Controller">
        <extends modification="T = 10, K = 2" extendedModelicaClass="//@modelicaClasses.0/@modelicaClasses.1/@modelicaClasses.0">
          <arraySize></arraySize>
        </extends>
        <modelicaComponents xsi:type="Modelica:ModelicaValueProperty" name="x" modification="" type_specifier="Real"/>
        <modelicaComponents xsi:type="Modelica:ModelicaPort" name="cOut" modification="" type_specifier="Two_tanks.Design.Interface.ActSignal" type_connector="//@modelicaClasses.0/@modelicaClasses.0/@modelicaClasses.0"/>
        <modelicaComponents xsi:type="Modelica:ModelicaPort" name="cIn" modification="" type_specifier="Two_tanks.Design.Interface.ReadSignal" type_connector="//@modelicaClasses.0/@modelicaClasses.0/@modelicaClasses.1"/>
        <equationSection>
          <equations body="der(x) = error / T"/>
          <equations body="outCtr = K * (error + x)"/>
        </equationSection>
        <comments body="@ReqID: 1.2 : After 350 sec, the liquid height must be stabilized in both tanks."/>
      </modelicaClasses>
      <modelicaClasses xsi:type="Modelica:Model" name="LiquidSource">
        <modelicaComponents xsi:type="Modelica:ModelicaValueProperty" name="flowLevel" modification="" type_specifier="Real" variability="parameter" default_value="0.02"/>
        <modelicaComponents xsi:type="Modelica:ModelicaPort" name="qOut" modification="" type_specifier="Two_tanks.Design.Interface.LiquidFlow" type_connector="//@modelicaClasses.0/@modelicaClasses.0/@modelicaClasses.2"/>
        <equationSection>
          <equations body="qOut.lflow = if time > 150 then 3 * flowLevel else flowLevel"/>
        </equationSection>
        <comments body="@ReqID: 1.1 : After 150 sec, the flow rate must be 3 times higher than the previous rate."/>
      </modelicaClasses>
      <modelicaClasses xsi:type="Modelica:Model" name="Tank">
        <modelicaComponents xsi:type="Modelica:ModelicaValueProperty" name="area" modification="unit = &quot;m2&quot;" type_specifier="Real" variability="parameter" default_value="0.5"/>
        <modelicaComponents xsi:type="Modelica:ModelicaValueProperty" name="flowGain" modification="unit = &quot;m2/s&quot;" type_specifier="Real" variability="parameter" default_value="0.05"/>
        <modelicaComponents xsi:type="Modelica:ModelicaValueProperty" name="minV" modification="" type_specifier="Real" variability="parameter" default_value="0.0"/>
        <modelicaComponents xsi:type="Modelica:ModelicaValueProperty" name="maxV" modification="" type_specifier="Real" variability="parameter" default_value="10.0"/>
        <modelicaComponents xsi:type="Modelica:ModelicaValueProperty" name="h" modification="unit = &quot;m&quot;, start = 0.0" type_specifier="Real"/>
        <modelicaComponents xsi:type="Modelica:ModelicaPort" name="qIn" modification="" type_specifier="Two_tanks.Design.Interface.LiquidFlow" type_connector="//@modelicaClasses.0/@modelicaClasses.0/@modelicaClasses.2"/>
        <modelicaComponents xsi:type="Modelica:ModelicaPort" name="tActuator" modification="" type_specifier="Two_tanks.Design.Interface.ActSignal" type_connector="//@modelicaClasses.0/@modelicaClasses.0/@modelicaClasses.0"/>
        <modelicaComponents xsi:type="Modelica:ModelicaPort" name="tSensor" modification="" type_specifier="Two_tanks.Design.Interface.ReadSignal" type_connector="//@modelicaClasses.0/@modelicaClasses.0/@modelicaClasses.1"/>
        <modelicaComponents xsi:type="Modelica:ModelicaPort" name="qOut" modification="" type_specifier="Two_tanks.Design.Interface.LiquidFlow" type_connector="//@modelicaClasses.0/@modelicaClasses.0/@modelicaClasses.2"/>
        <equationSection>
          <equations body="assert(minV >=  0, &quot;minV - minimum Valve level must be >= 0&quot;)"/>
          <equations body="der(h) = (qIn.lflow - qOut.lflow) / area"/>
          <equations body="qOut.lflow = limitValue(minV, maxV, -flowGain * tActuator.act)"/>
          <equations body="tSensor.val = h"/>
        </equationSection>
      </modelicaClasses>
      <modelicaClasses xsi:type="Modelica:Model" name="TanksConnectedPI">
        <modelicaComponents xsi:type="Modelica:ModelicaPart" name="source" modification="flowLevel = 0.02" type_specifier="Two_tanks.Design.Components.LiquidSource" type_part="//@modelicaClasses.0/@modelicaClasses.1/@modelicaClasses.2"/>
        <modelicaComponents xsi:type="Modelica:ModelicaPart" name="tank1" modification="area = 1" type_specifier="Two_tanks.Design.Components.Tank" type_part="//@modelicaClasses.0/@modelicaClasses.1/@modelicaClasses.3"/>
        <modelicaComponents xsi:type="Modelica:ModelicaPart" name="controller1" modification="ref = 0.25" type_specifier="Two_tanks.Design.Components.Controller" type_part="//@modelicaClasses.0/@modelicaClasses.1/@modelicaClasses.1"/>
        <modelicaComponents xsi:type="Modelica:ModelicaPart" name="tank2" modification="area = 1.3" type_specifier="Two_tanks.Design.Components.Tank" type_part="//@modelicaClasses.0/@modelicaClasses.1/@modelicaClasses.3"/>
        <modelicaComponents xsi:type="Modelica:ModelicaPart" name="controller2" modification="ref = 0.4" type_specifier="Two_tanks.Design.Components.Controller" type_part="//@modelicaClasses.0/@modelicaClasses.1/@modelicaClasses.1"/>
        <equationSection>
          <connects from="//@modelicaClasses.0/@modelicaClasses.1/@modelicaClasses.2/@modelicaComponents.1" to="//@modelicaClasses.0/@modelicaClasses.1/@modelicaClasses.3/@modelicaComponents.5" fromModelicaPart="//@modelicaClasses.0/@modelicaClasses.1/@modelicaClasses.4/@modelicaComponents.0" toModelicaPart="//@modelicaClasses.0/@modelicaClasses.1/@modelicaClasses.4/@modelicaComponents.1"/>
          <connects from="//@modelicaClasses.0/@modelicaClasses.1/@modelicaClasses.1/@modelicaComponents.1" to="//@modelicaClasses.0/@modelicaClasses.1/@modelicaClasses.3/@modelicaComponents.6" fromModelicaPart="//@modelicaClasses.0/@modelicaClasses.1/@modelicaClasses.4/@modelicaComponents.2" toModelicaPart="//@modelicaClasses.0/@modelicaClasses.1/@modelicaClasses.4/@modelicaComponents.1"/>
          <connects from="//@modelicaClasses.0/@modelicaClasses.1/@modelicaClasses.1/@modelicaComponents.2" to="//@modelicaClasses.0/@modelicaClasses.1/@modelicaClasses.3/@modelicaComponents.7" fromModelicaPart="//@modelicaClasses.0/@modelicaClasses.1/@modelicaClasses.4/@modelicaComponents.2" toModelicaPart="//@modelicaClasses.0/@modelicaClasses.1/@modelicaClasses.4/@modelicaComponents.1"/>
          <connects from="//@modelicaClasses.0/@modelicaClasses.1/@modelicaClasses.3/@modelicaComponents.8" to="//@modelicaClasses.0/@modelicaClasses.1/@modelicaClasses.3/@modelicaComponents.5" fromModelicaPart="//@modelicaClasses.0/@modelicaClasses.1/@modelicaClasses.4/@modelicaComponents.1" toModelicaPart="//@modelicaClasses.0/@modelicaClasses.1/@modelicaClasses.4/@modelicaComponents.3"/>
          <connects from="//@modelicaClasses.0/@modelicaClasses.1/@modelicaClasses.1/@modelicaComponents.2" to="//@modelicaClasses.0/@modelicaClasses.1/@modelicaClasses.3/@modelicaComponents.7" fromModelicaPart="//@modelicaClasses.0/@modelicaClasses.1/@modelicaClasses.4/@modelicaComponents.4" toModelicaPart="//@modelicaClasses.0/@modelicaClasses.1/@modelicaClasses.4/@modelicaComponents.3"/>
          <connects from="//@modelicaClasses.0/@modelicaClasses.1/@modelicaClasses.1/@modelicaComponents.1" to="//@modelicaClasses.0/@modelicaClasses.1/@modelicaClasses.3/@modelicaComponents.6" fromModelicaPart="//@modelicaClasses.0/@modelicaClasses.1/@modelicaClasses.4/@modelicaComponents.4" toModelicaPart="//@modelicaClasses.0/@modelicaClasses.1/@modelicaClasses.4/@modelicaComponents.3"/>
        </equationSection>
        <comments body="@ReqID: 1.0 : The system must fulfill two tanks. "/>
      </modelicaClasses>
      <modelicaClasses xsi:type="Modelica:Function" name="limitValue" externalLanguage="Modelica">
        <algorithmSections body="pLim:=if p > pMax then pMax else if p &lt; pMin then pMin else p;"/>
        <parameters name="pMin" causality="input" modification="" type_specifier="Real">
          <arraySize></arraySize>
        </parameters>
        <parameters name="pMax" causality="input" modification="" type_specifier="Real">
          <arraySize></arraySize>
        </parameters>
        <parameters name="p" causality="input" modification="" type_specifier="Real">
          <arraySize></arraySize>
        </parameters>
        <parameters name="pLim" causality="output" modification="" type_specifier="Real">
          <arraySize></arraySize>
        </parameters>
      </modelicaClasses>
    </modelicaClasses>
  </modelicaClasses>
</Modelica:ModelicaModel>
